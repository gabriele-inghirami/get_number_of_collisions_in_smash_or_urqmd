## Contents:

- get_number_of_collisions.py extracts the number of collisions vs time (see dedicated paragrahs _main program_ and _syntax_)
- combine_results.py combines homogeneous results (see dedicate paragraph _Combining the results_)
- definition.py auxiliary python code with definitions and helper functions
- diff_or_ratio_results.py computes the differences or the ratios between two sets of results (option inside the code)
- LICENSE
- print_txt.py converts output of get_number_of_collisions.py or diff_or_ratio_results.py into human readable text format suitable for gnuplot
- README.md
- scripts_and_configs


## Main program: get_number_of_collisions.py

This progam reads the hadron data in the SMASH or UrQMD collision files, extracts
the time and the type of collisions and saves a histogram on a file.
The program automatically detects if the file is a .f15 UrQMD or
an oscar2013 SMASH collision file.

### Syntax:

`python3 get_number_of_collisions.py <output file name> <output file header info> <collision file 1> [collision file 2] ...`

Example: `python3 get_number_of_collisions.py smash_200.dat "Au+Au, 200 GeV, b=0-3.3 fm" out1/full_event_history.oscar out2/full_event_history.oscar`

The script automatically recognizes if the collision files have been generated by UrQMD or SMASH.
A short description of the content of the output file is provided in its header.

### Combining the results
It is possible to combine the results of two or more result files created by get_number_of_collisions.py with:

`python3 combine_results.py <outputfile> <inputfile 1> <inputfile 2> ... [inputfile n]`

### Converting into txt format
It is possible to convert the results into human readable txt format with:

`python3 print_txt.py <pickled data results file> <output directory>`

In output directory will be saved three files:
- collision_types.dat (dN/dt of collisions by kind: elastic, decays, strings, other)
- hadron_types.dat (dN/dt of collisions by colliding ion species: 2 baryons, 2 mesons...)
- process_types.dat (dN/dt of collisions by process type: soft strings, hard string, elastic...)
The contents of the files are described in their headers.
print_txt.py is able to automatically recognize whether the input file was produced by diff_or_ratio_results.py or get_number_of_collisions.py.

## Config files, slurm and gnuplot scripts

The directory *scripts_and_configs* contains example configuration files and slurm scripts (used on the Virgo cluster at GSI),
both for SMASH and UrQMD. The subdirectory _gnuplot_ contains gnuplot scripts (tested with v. 5.4.4) to make plots from postprocessed results in txt format.

## Workflow example:

In the Virgo cluster:
`./launch_runs_smash.sh`
this starts the jobs. slurm is used in a script invoked by this script (e.g. run_smash.bash)

When they are over:
`sbatch postproc_smash.sh`
this executes get_number_of_collision.py and produces in output several pickle files.

When finished, we can first start a container (or use a VAE, like Debian or CentOS):
`singularity shell $CON`
and then combine the results, e.g.:
`python3 combine_results.py smash_17_3.pickle smash17_p*le`
(this operation must be repeated for all cases or included in a script)

We use ftp or rsync to copy the final pickle data results in a local directory.

In the local computer:
we convert the pickled data into text format:
`python3 print_txt.py smash_17_3.pickle 17_3`

we make the plots:
`gnuplot make_plots.gp`
we convert the plots into pdf:
`for i in *.eps; do ps2pdf -dEPSCrop $i; done`
`rm *.eps` (optional)
we convert from pdf to jpg (optional, useful to display plots in a github issue):
`for i in *.pdf; do convert -density 300 -quality 95% $i ${i%%pdf}jpg; done`

### Differences between two different sets of results

If we want to compare the differences betweent two different kinds of results:
`id=8_7; python3 diff_or_ratio_results.py diff_smash_std_smash_-1/$id.pickle smash_all_data/smash_$id.pickle smash_all_data_-1_option/smash_$id.pickle`

we convert the results into text format:
`python3 print_txt.py 8_7.pickle 8_7`

we make the plots:
`gnuplot make_plots_comp.gp`
